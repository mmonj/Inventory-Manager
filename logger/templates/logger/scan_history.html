{% extends "logger/layout.html" %}
{% load static %}

{% block title %}Scan History{% endblock %}

{% block extra_head_elements %}
  <meta name="csrf_token" content="{{ csrf_token }}" />
  
  <style>
    .truncated-text-container {
      min-width: 0;
    }
    
    .truncated-text {
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.3.slim.min.js" integrity="sha256-ZwqZIVdD3iXNyGHbSYdsmWP//UBokj2FHAxKuSBKDSo=" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <script defer src="{% static 'logger/scripts/util.js' %}"></script>
  <script defer src="{% static 'logger/scripts/scan_history.js' %}"></script>
{% endblock %}

{% block body_header %}
  {% include "logger/includes/navbar.html" %}
{% endblock %}

{% block body_main %}
  {% if territory_list %}
    <h1 class="m-3 text-center title-color">Scan History</h1>
    {% include "logger/includes/store_picker.html" %}
    <script id="territory_list" type="application/json">{{ territory_list | safe }}</script>
  {% endif %}

  <section class="mw-rem-60 mx-auto">
    <h3 class="m-3 text-center title-color">{{store_name}}</h1>
    <ol class="list-group">
        {% for product_addition in product_additions %}
          <li class="list-group-item product-list-item collapse show">
            <form class="form-unsubmit-product" action="{% url 'logger:uncarry_product_addition' product_addition.pk %}" method="POST">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">{{ product_addition.product.upc }}</h5>
                <small class="text-muted">{{ product_addition.date_last_scanned }}</small>
              </div>
              <div class="d-flex flex-row justify-content-between">
                <div class="truncated-text-container">
                  <p class="truncated-text mb-1">{{ product_addition.product.name }}</p>
                  <small class="text-muted">{{ product_addition.product.parent_company.short_name | default:"Unknown Brand" }}</small>
                </div>

                <div class="spinner-remove-product my-auto" hidden="">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
                <button type="submit" class="button-remove-product btn btn-primary badge rounded-pill my-auto ms-2 py-2">Delete</button>
              </div>
            </form>
          </li>
        {% endfor %}
    </ol>

    <div class="toast-container top-50 start-50 translate-middle">
      <div id="alert-toast" class="toast p-1" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
          <svg class="me-2" viewBox="0 0 16 16" fill="currentColor" height="16" width="16" xmlns="http://www.w3.org/2000/svg">
            <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"></path>
          </svg>
          <strong class="_toast-title me-auto h6 mb-0">Error</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
          Hello, world! This is a toast message.
        </div>
      </div>
    </div>
  </section>

{% endblock %}
